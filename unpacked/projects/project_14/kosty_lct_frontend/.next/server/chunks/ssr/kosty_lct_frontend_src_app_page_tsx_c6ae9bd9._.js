module.exports=[20119,a=>{"use strict";a.s(["default",()=>B],20119);var b=a.i(85631),c=a.i(15014),d=a.i(6365),e=a.i(20150);let f=(0,e.default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),g=(0,e.default)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);a.i(38319);var h=a.i(48853),i=a.i(12666),j=a.i(46147),k=a.i(19699),l=a.i(45386),m=a.i(10516),n=a.i(89803),o=a.i(42226);function p({...a}){return(0,b.jsx)(m.Root,{"data-slot":"dialog",...a})}function q({...a}){return(0,b.jsx)(m.Portal,{"data-slot":"dialog-portal",...a})}function r({className:a,...c}){return(0,b.jsx)(m.Overlay,{"data-slot":"dialog-overlay",className:(0,o.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",a),...c})}function s({className:a,children:c,showCloseButton:d=!0,...e}){return(0,b.jsxs)(q,{"data-slot":"dialog-portal",children:[(0,b.jsx)(r,{}),(0,b.jsxs)(m.Content,{"data-slot":"dialog-content",className:(0,o.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",a),...e,children:[c,d&&(0,b.jsxs)(m.Close,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,b.jsx)(n.XIcon,{}),(0,b.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function t({className:a,...c}){return(0,b.jsx)("div",{"data-slot":"dialog-header",className:(0,o.cn)("flex flex-col gap-2 text-center sm:text-left",a),...c})}function u({className:a,...c}){return(0,b.jsx)("div",{"data-slot":"dialog-footer",className:(0,o.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",a),...c})}function v({className:a,...c}){return(0,b.jsx)(m.Title,{"data-slot":"dialog-title",className:(0,o.cn)("text-lg leading-none font-semibold",a),...c})}function w({className:a,...c}){return(0,b.jsx)(m.Description,{"data-slot":"dialog-description",className:(0,o.cn)("text-muted-foreground text-sm",a),...c})}var x=a.i(19317);a.i(78323);var y=a.i(52011);let z={stable:"Мониторинг активен",warning:"Требует проверки",critical:"Повышенное внимание"},A={ready:"Отчёт доступен",processing:"В обработке",scheduled:"Запланировано"};function B(){let a=(0,c.useRouter)(),[e,m]=(0,d.useState)(!1),[n,o]=(0,d.useState)(!1),[q,r]=(0,d.useState)(""),[B,C]=(0,d.useState)(!1),[D,E]=(0,d.useState)([]),[F,G]=(0,d.useState)([]),[H,I]=(0,d.useState)(!1),[J,K]=(0,d.useState)(!1),L=(0,d.useRef)(null),M=(0,d.useRef)(null),N=(0,d.useRef)(null),[O,P]=(0,d.useState)(""),[Q,R]=(0,d.useState)([]),[S,T]=(0,d.useState)(!1),U=(0,d.useMemo)(()=>new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),[]);(0,d.useEffect)(()=>{let a=new AbortController,b=new AbortController;return async function(){I(!0),K(!0);try{let[c,d]=await Promise.all([(0,h.fetchRecentPatients)(a.signal),(0,i.fetchRecentStudies)(b.signal)]);E(c),G(d)}catch(a){console.error("Не удалось загрузить данные главной страницы",a)}finally{I(!1),K(!1)}}(),()=>{a.abort(),b.abort()}},[]);let V=async b=>{b.preventDefault();let c=q.trim();if(c){C(!0);try{let b=await (0,h.createPatient)({fullName:c});m(!1),r(""),b&&E(a=>[{id:b.id,fullName:b.fullName,lastStudyType:"Мониторинг запущен",lastStudyDate:new Date().toISOString(),monitoringStatus:"stable"},...a]);let d=`/monitoring?patient=${encodeURIComponent(c)}`;a.push(d)}catch(a){console.error("Не удалось создать пациента",a)}finally{C(!1)}}};return(0,d.useEffect)(()=>{!n&&(P(""),R([]),T(!1),N.current&&(clearTimeout(N.current),N.current=null),M.current&&(M.current.abort(),M.current=null))},[n]),(0,d.useEffect)(()=>{let a=O.trim();if(n){if(N.current&&clearTimeout(N.current),!a){R([]),T(!1);return}return N.current=setTimeout(async()=>{M.current&&M.current.abort();let b=new AbortController;M.current=b,T(!0);try{let c=await (0,h.searchPatients)(a,b.signal);R(c)}catch(a){console.error("Не удалось выполнить поиск пациентов",a)}finally{T(!1),M.current=null}},350),()=>{N.current&&(clearTimeout(N.current),N.current=null)}}},[O,n]),(0,b.jsxs)(y.AppSidebarLayout,{title:"Главная",contentClassName:"gap-10 px-6 py-10",children:[(0,b.jsxs)("section",{className:"max-w-3xl space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h2",{className:"text-3xl font-semibold tracking-tight",children:"Добро пожаловать!"}),(0,b.jsx)("p",{className:"text-muted-foreground text-base",children:"Управляйте мониторингом пациентов, создавайте новые записи и возвращайтесь к последним исследованиям в один клик."})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,b.jsxs)(k.Button,{onClick:()=>{m(!0)},size:"lg",children:[(0,b.jsx)(g,{className:"mr-2 size-4"}),"Добавить пациента"]}),(0,b.jsxs)(k.Button,{onClick:()=>{o(!0)},size:"lg",variant:"outline",children:[(0,b.jsx)(f,{className:"mr-2 size-4"}),"Найти пациента"]})]}),(0,b.jsxs)(l.Card,{className:"max-w-2xl",children:[(0,b.jsxs)(l.CardHeader,{children:[(0,b.jsx)(l.CardTitle,{children:"Активные пациенты"}),(0,b.jsx)(l.CardDescription,{children:"Последние пациенты, у которых запущен мониторинг."})]}),(0,b.jsx)(l.CardContent,{className:"space-y-4",children:H?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Загрузка списка…"}):D.length?D.slice(0,4).map(a=>(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3 border-b pb-4 last:border-none last:pb-0",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium leading-none",children:a.fullName}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.lastStudyType}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground/80",children:U.format(new Date(a.lastStudyDate))})]}),(0,b.jsx)(j.Badge,{variant:"outline",className:"border-muted-foreground/30 text-muted-foreground",children:z[a.monitoringStatus]})]},a.id)):(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Пока нет активных пациентов."})})]})]}),(0,b.jsxs)("section",{ref:L,className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-2xl font-semibold",children:"Недавние исследования"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Последние обследования, требующие внимания врача."})]})}),(0,b.jsx)("div",{className:"grid gap-4 lg:grid-cols-2 xl:grid-cols-3",children:J?(0,b.jsx)(l.Card,{children:(0,b.jsxs)(l.CardHeader,{children:[(0,b.jsx)(l.CardTitle,{children:"Загрузка исследований…"}),(0,b.jsx)(l.CardDescription,{children:"Данные поступят через несколько секунд."})]})}):F.length?F.map(a=>(0,b.jsxs)(l.Card,{className:"h-full",children:[(0,b.jsxs)(l.CardHeader,{children:[(0,b.jsx)(l.CardTitle,{children:a.patientName}),(0,b.jsx)(l.CardDescription,{children:a.modality}),(0,b.jsx)(j.Badge,{variant:"outline",className:"border-muted-foreground/30 text-muted-foreground",children:A[a.status]})]}),(0,b.jsxs)(l.CardContent,{className:"space-y-3",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:U.format(new Date(a.performedAt))}),(0,b.jsx)("p",{className:"text-sm leading-relaxed",children:a.findingsSummary})]})]},a.id)):(0,b.jsx)(l.Card,{children:(0,b.jsxs)(l.CardHeader,{children:[(0,b.jsx)(l.CardTitle,{children:"Нет недавних исследований"}),(0,b.jsx)(l.CardDescription,{children:"Как только появятся новые исследования, они отобразятся здесь."})]})})})]}),(0,b.jsx)(p,{open:e,onOpenChange:m,children:(0,b.jsxs)(s,{showCloseButton:!1,children:[(0,b.jsxs)(t,{children:[(0,b.jsx)(v,{children:"Введите ФИО пациента"}),(0,b.jsx)(w,{children:"Эта информация поможет персонализировать мониторинг пациента."})]}),(0,b.jsxs)("form",{className:"space-y-4",onSubmit:V,children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"patient-name",children:"ФИО пациента"}),(0,b.jsx)(x.Input,{id:"patient-name",value:q,onChange:a=>r(a.target.value),placeholder:"Иванов Иван Иванович",autoComplete:"name",autoFocus:!0})]}),(0,b.jsx)(u,{children:(0,b.jsx)(k.Button,{type:"submit",disabled:!q.trim()||B,className:"min-w-[160px]",children:B?"Создаём карточку…":"Перейти к мониторингу"})})]})]})}),(0,b.jsx)(p,{open:n,onOpenChange:o,children:(0,b.jsxs)(s,{className:"max-w-2xl",children:[(0,b.jsxs)(t,{children:[(0,b.jsx)(v,{children:"Найти пациента"}),(0,b.jsx)(w,{children:"Введите ФИО, номер истории болезни или другую информацию."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(x.Input,{value:O,onChange:a=>P(a.target.value),placeholder:"Например, Петрова Анастасия",autoFocus:!0}),(0,b.jsx)("div",{className:"space-y-3",children:S?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Выполняем поиск…"}):O.trim()&&!Q.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Пациенты не найдены. Попробуйте изменить запрос."}):Q.map(c=>(0,b.jsxs)("div",{className:"flex flex-col gap-3 rounded-lg border p-4 transition-colors hover:border-muted-foreground/40",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium leading-none",children:c.fullName}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["История болезни: ",c.medicalRecord]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground/80",children:["Дата рождения: ",c.birthDate]})]}),(0,b.jsx)(k.Button,{size:"sm",className:"self-start",onClick:()=>(b=>{o(!1),P(""),R([]);let c=`/monitoring?patient=${encodeURIComponent(b.fullName)}&patientId=${encodeURIComponent(b.id)}`;a.push(c)})(c),children:"Перейти к мониторингу"})]},c.id))})]})]})})]})}}];

//# sourceMappingURL=kosty_lct_frontend_src_app_page_tsx_c6ae9bd9._.js.map